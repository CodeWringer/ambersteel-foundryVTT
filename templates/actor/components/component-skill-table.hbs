{{!-- Requires parameters: 
isEditable: {Boolean}
isSendable: {Boolean}
isLearningSkillsTable: {Boolean}
skills: {[Object]} = {
    name: {String}
    data: {Object} ? {
        id: {String}
        value: {Number}
        successes: {Number}
        failures: {Number}
        requiredSuccessses: {Number}
        requiredFailures: {Number}
        relatedAttribute: {String}
        abilities: {[Object]} -> see item/parts/skill-ability-table.hbs
        localizableName: {String}
    }
}
--}}
<div>
    <table class="skill-table">
        <tbody>
            <tr class="fancy-font">
                {{#if isEditable}}
                    <th class="skill-column-roll"></th>
                {{/if}}
                <th class="skill-column-name">
                    {{#if isLearningSkillsTable}}
                        {{localize "ambersteel.labels.learningSkill"}}
                    {{else}}
                        {{localize "ambersteel.labels.knownSkill"}}
                    {{/if}}
                </th>
                <th class="skill-column-attribute">
                    {{localize "ambersteel.labels.attributeAbbreviation"}}
                </th>
                <th class="skill-column-level">
                    {{localize "ambersteel.labels.level"}}
                </th>
                <th class="skill-column-requirements">
                    {{localize "ambersteel.labels.requiredSuccessFailureAbbreviation"}}
                </th>
                <th class="skill-column-successes">
                    {{localize "ambersteel.labels.successAbbreviation"}}
                </th>
                <th class="skill-column-failures">
                    {{localize "ambersteel.labels.failureAbbreviation"}}
                </th>
                {{#if isEditable}}
                    <th class="skill-column-delete"></th>
                {{/if}}
            </tr>
            {{#each skills as |skill key|}}
                <tr class="item skill-item" data-item-id="{{skill.data.id}}">
                    {{#if ../isEditable}}
                        <td class="skill-column-roll">
                            {{> buttonRoll
                                type="dice-pool"
                                itemId=skill.data.id
                                chatTitle=skill.name
                                callback="advanceSkillBasedOnRollResult"
                                callbackData=(concat key "|" ../isLearningSkillsTable)
                            }}
                        </td>
                    {{/if}}
                    <td class="fancy-font flex skill-column-name">
                        <input class="skill-name ambersteel-item-edit" name="" type="text" value="{{skill.name}}" 
                            data-field="name" data-item-id="{{skill.data.id}}" />
                    </td>
                    <td class="skill-column-attribute">
                        <select class="ambersteel-item-edit" name="data.relatedAttribute" data-field="data.relatedAttribute" data-item-id="{{skill.data.id}}">
                            {{#select data.relatedAttribute}}
                            {{#each ../CONFIG.character.attributes as | att |}}
                            <option value="{{att.name}}">{{localize att.localizableAbbreviation}}</option>
                            {{/each}}
                            {{/select}}
                        </select>
                    </td>
                    <td class="skill-column-level">
                        {{#if ../isEditable}}
                            {{#> numberSpinner}}
                            <input class="skill-value ambersteel-item-edit spinner" name="" type="number" data-dtype="Number" min="0" step="1" 
                                value="{{data.value}}" data-field="data.value" data-item-id="{{skill.data.id}}" />
                            {{/numberSpinner}}
                        {{else}}
                            {{data.value}}
                        {{/if}}
                    </td>
                    <td class="skill-column-requirements">
                        {{data.requiredSuccessses}} / {{data.requiredFailures}}
                    </td>
                    <td class="skill-column-successes">
                        {{#if ../isEditable}}
                            {{#> numberSpinner}}
                            <input class="skill-successes ambersteel-item-edit" name="" type="number" data-dtype="Number" min="0" step="1" 
                                value="{{data.successes}}" data-field="data.successes" data-item-id="{{skill.data.id}}" />
                            {{/numberSpinner}}
                        {{else}}
                            {{data.successes}}
                        {{/if}}
                    </td>
                    <td class="skill-column-failures">
                        {{#if ../isEditable}}
                            {{#> numberSpinner}}
                            <input class="skill-failures ambersteel-item-edit" name="" type="number" data-dtype="Number" min="0" step="1" 
                                value="{{data.failures}}" data-field="data.failures" data-item-id="{{skill.data.id}}" />
                            {{/numberSpinner}}
                        {{else}}
                            {{data.failures}}
                        {{/if}}
                    </td>
                    {{#if ../isEditable}}
                        <td class="skill-column-delete">
                            {{> buttonDelete itemId=skill.data.id }}
                        </td>
                    {{/if}}
                </tr>
                <tr>
                    <td style="display: table-cell;" colspan="100">
                        <div class="{{#if data.isExpanded}}{{else}}hidden{{/if}}">
                            {{> "systems/ambersteel/templates/item/parts/skill-ability-table.hbs" 
                                isEditable=../isEditable
                                isSendable=../isSendable
                                skillItemId=skill.data.id
                                itemId=skill.data.id
                                abilities=data.abilities
                            }}
                        </div>
                        {{> buttonToggleSkillAbilityList itemId=skill.data.id isToggled=data.isExpanded }}
                    </td>
                </tr>
            {{/each}}
            {{#if isEditable}}
                <tr>
                    <td style="display: table-cell;" colspan="100">
                        <div class="flex">
                            <span class="flex-grow"></span>
                            <a class="ambersteel-item-create pad-sm" data-type="skill" data-value="{{#if isLearningSkillsTable}}0{{else}}1{{/if}}" 
                                data-related-attribute="agility" title="{{localize ambersteel.labels.addSkill}}">
                                <i class="fas fa-plus"></i>
                            </a>
                        </div>
                    </td>
                </tr>
            {{/if}}
        </tbody>
    </table>
</div>